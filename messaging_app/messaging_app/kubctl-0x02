#!/bin/bash

# kubctl-0x02.sh
# Blue-Green Deployment Script

BLUE_DEPLOY="blue_deployment.yaml"
GREEN_DEPLOY="green_deployment.yaml"
SERVICE_FILE="kubeservice.yaml"

echo "ğŸš€ Deploying Blue version..."
kubectl apply -f $BLUE_DEPLOY

echo "ğŸš€ Deploying Green version..."
kubectl apply -f $GREEN_DEPLOY

echo "â³ Waiting for pods to be ready..."
kubectl rollout status -f $GREEN_DEPLOY

echo "ğŸ“‹ Checking running pods..."
kubectl get pods -l app=django-messaging -o wide

echo "ğŸ” Checking logs of Green version..."
GREEN_POD=$(kubectl get pods -l app=django-messaging,version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs $GREEN_POD

echo "ğŸ“Œ Applying service (currently pointing to Blue)..."
kubectl apply -f $SERVICE_FILE

echo "âœ… Blue-Green deployment completed."
echo "ğŸ‘‰ To switch traffic, edit $SERVICE_FILE selector from 'blue' to 'green' and re-apply it."

